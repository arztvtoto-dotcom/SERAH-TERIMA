<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Report V7 - Complete Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .kendala-item { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1f2937; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* Glow Effects */
        .glow { box-shadow: 0 0 15px rgba(99, 102, 241, 0.2); }
        .glow-gold { box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }
        .glow-green { box-shadow: 0 0 15px rgba(16, 185, 129, 0.2); }
        
        /* Checkbox Custom */
        .check-btn.active { border-color: #10b981; background-color: #064e3b; }
        .check-btn.inactive { border-color: #ef4444; background-color: #7f1d1d; }
        
        /* Reminder Badge Pulse */
        .pulse-red { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .history-item { transition: all 0.2s; }
        .history-item:hover { transform: translateX(-4px); border-color: #60a5fa; }

        /* =====================================================
           REPORT OUTPUT ‚Äî FULL TEXT, NO TRUNCATION
           ===================================================== */
        .report-output-wrapper {
            overflow-x: auto;
            overflow-y: auto;
            width: 100%;
            border-radius: 0.5rem;
            background: rgba(0,0,0,0.5);
            border: 1px solid #1e3a2e;
        }

        #output {
            display: block;
            width: 100%;
            min-width: max-content;
            min-height: 200px;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: break-word;
            overflow: visible;
            padding: 0.875rem;
            background: transparent;
            color: #d1fae5;
            font-family: 'Courier New', Courier, monospace;
            font-size: 11px;
            line-height: 1.7;
            resize: none;
            outline: none;
            border: none;
        }

        @media (max-width: 640px) {
            #output { font-size: 10px; }
        }

        /* Kendala list items: no truncation */
        #kendalaList p,
        #kendalaList .text-xs {
            white-space: normal;
            word-break: break-word;
            overflow: visible;
            text-overflow: unset;
        }

        /* History items: no truncation on preview text */
        .history-item .font-mono {
            white-space: normal;
            word-break: break-word;
            overflow: visible;
            text-overflow: unset;
        }

        /* =====================================================
           RIGHT PANEL ‚Äî REPORT OUTPUT EMBEDDED IN RIWAYAT
           ===================================================== */
        .output-panel-embedded {
            background: linear-gradient(135deg, #064e3b, #022c22);
            border: 1px solid #065f46;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
        }

        .output-panel-embedded .output-label {
            font-size: 11px;
            font-weight: 700;
            color: #6ee7b7;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .output-panel-embedded .output-actions {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen p-2 md:p-4">
    <div class="max-w-[1700px] mx-auto h-full flex flex-col">
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl shadow-2xl overflow-hidden border border-gray-700 glow flex flex-col h-full">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-900 via-indigo-900 to-blue-900 p-4 md:p-6 text-white border-b border-purple-700 shrink-0">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">SERAH TERIMA CS TVTOTO <span class="text-white text-base font-normal opacity-80"></span></h1>
                        <p class="text-purple-200 text-xs md:text-sm font-medium mt-1"></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="openImportModal()" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded-lg flex items-center gap-2 transition-all shadow-lg font-semibold text-xs border-2 border-blue-400">
                            üì• IMPORT DARI TEXT
                        </button>
                        <button onclick="resetAllData()" class="bg-gray-700 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-all shadow-lg font-semibold text-xs">
                            üîÑ Reset
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-4 flex-1 overflow-hidden flex flex-col xl:flex-row gap-5">
                
                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     LEFT COLUMN (30%): Inputs, Checklist, Manual Input
                ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="xl:w-[30%] flex flex-col gap-4 overflow-y-auto pr-1 pb-4">
                    
                    <!-- CS Info -->
                    <div class="bg-gradient-to-r from-gray-800 to-gray-700 p-4 rounded-xl border-2 border-gray-600 glow shrink-0">
                        <h2 class="text-gray-300 font-bold mb-3 border-b border-gray-600 pb-2 flex justify-between">
                            <span>üë§ ÔºµÔº¨Ôº° Ôº´Ôº°Ôº≠ Ôº≥Ôº°ÔºÆÔº´Ôº≥Ôº©  Ôº∞Ôº°Ôº¨</span>
                        </h2>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="flex gap-2">
                                <input type="text" id="csName" class="w-1/2 p-2 border-2 border-gray-600 bg-gray-800 text-white rounded-lg focus:border-purple-500 focus:outline-none text-sm font-semibold" placeholder="Nama CS">
                                <select id="shift" class="w-1/2 p-2 border-2 border-gray-600 bg-gray-800 text-white rounded-lg focus:border-purple-500 focus:outline-none text-sm font-semibold">
                                    <option value="Pagi">Pagi</option>
                                    <option value="Sore">Sore</option>
                                    <option value="Malam">Malam</option>
                                </select>
                            </div>
                            <div>
                                <input type="text" id="linkYT" class="w-full p-2 border-2 border-red-900 bg-gray-800 text-white rounded-lg focus:border-red-500 focus:outline-none text-xs font-mono mb-2" placeholder="üî¥ Link YT...">
                                <input type="text" id="linkAman" class="w-full p-2 border-2 border-green-900 bg-gray-800 text-white rounded-lg focus:border-green-500 focus:outline-none text-xs font-mono" placeholder="üü¢ Link Aman...">
                            </div>
                        </div>
                    </div>

                    <!-- Checklist -->
                    <div class="bg-gradient-to-r from-emerald-900 to-green-900 p-4 rounded-xl border-2 border-emerald-700 glow flex-1 flex flex-col min-h-[200px]">
                        <div class="flex items-center justify-between mb-3 shrink-0">
                            <h2 class="text-lg font-bold text-emerald-100">üìã Checklist</h2>
                            <div class="flex gap-1">
                                <button onclick="toggleAll(true)" class="text-[10px] bg-emerald-700 hover:bg-emerald-600 text-white px-2 py-1 rounded">All</button>
                                <button onclick="toggleAll(false)" class="text-[10px] bg-red-900 hover:bg-red-800 text-white px-2 py-1 rounded">None</button>
                            </div>
                        </div>
                        <div id="checklistContainer" class="grid grid-cols-1 gap-1.5 overflow-y-auto pr-1 flex-1 content-start"></div>
                    </div>

                    <!-- Input Kendala Manual -->
                    <div class="bg-gradient-to-br from-orange-900 to-red-900 p-4 rounded-xl border-2 border-orange-700 glow-gold shrink-0">
                        <h3 class="text-sm font-bold text-orange-100 mb-2 flex items-center gap-2">
                            <span>‚úèÔ∏è</span> Input Kendala Manual
                        </h3>
                        <div class="mb-2">
                            <textarea id="kendalaText" placeholder="Contoh: WD BCA Delay / Gangguan..." class="w-full p-2.5 border-2 border-orange-600 bg-gray-800 text-white placeholder-gray-500 rounded-lg focus:border-orange-400 focus:outline-none resize-none h-16 font-mono text-xs"></textarea>
                        </div>
                        <div class="mb-3">
                            <select id="kategoriDropdown" class="w-full p-2 border-2 border-orange-600 bg-gray-800 text-white rounded-lg focus:border-orange-400 focus:outline-none font-semibold text-xs">
                                <option value="bank">üè¶ KENDALA BANK</option>
                                <option value="game">üéÆ KENDALA GAME</option>
                                <option value="provider">üì± KENDALA PROVIDER</option>
                                <option value="lainnya">‚ö†Ô∏è KENDALA LAINNYA</option>
                            </select>
                        </div>
                        <button onclick="tambahKendalaBaru()" class="w-full bg-orange-600 hover:bg-orange-500 text-white py-2 rounded-lg font-bold text-sm transition-all shadow-lg">
                            ‚ûï TAMBAH MANUAL
                        </button>
                    </div>

                    <!-- Quick Templates -->
                    <div class="bg-gray-800 p-3 rounded-xl border border-gray-700 shrink-0">
                        <h3 class="text-xs font-bold text-yellow-500 mb-2 uppercase tracking-wide"></h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="quickAdd('BCA Offline / Gangguan', 'bank')" class="bg-gray-700 hover:bg-blue-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-blue-500 transition-colors text-left">üè¶ BCA Offline</button>
                            <button onclick="quickAdd('BRI Gangguan / Maintenance', 'bank')" class="bg-gray-700 hover:bg-blue-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-blue-500 transition-colors text-left">üè¶ BRI Gangguan</button>
                            <button onclick="quickAdd('BNI Gangguan / Down', 'bank')" class="bg-gray-700 hover:bg-green-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-green-500 transition-colors text-left">üè¶ BNI Gangguan</button>
                            <button onclick="quickAdd('MANDIRI Offline / bank', 'bank')" class="bg-gray-700 hover:bg-blue-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-blue-500 transition-colors text-left">üè¶ MANDIRI Offline</button>
                            <button onclick="quickAdd('Slot / Game Lag', 'game')" class="bg-gray-700 hover:bg-purple-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-purple-500 transition-colors text-left">üéÆ Game Lag</button>
                            <button onclick="quickAdd('Live Chat Error', 'provider')" class="bg-gray-700 hover:bg-orange-900 text-gray-200 text-[10px] py-1.5 px-2 rounded border border-gray-600 hover:border-orange-500 transition-colors text-left">üí¨ LC Error</button>
                        </div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     MIDDLE COLUMN (40%): Reminder, Kendala
                     [Hasil Report DIPINDAH ke kanan]
                ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="xl:w-[40%] flex flex-col gap-4 h-full overflow-hidden">
                    
                    <!-- Pengingat Panel -->
                    <div class="bg-gradient-to-br from-indigo-900 to-purple-900 p-4 rounded-xl border border-indigo-600 shrink-0 relative overflow-hidden" id="reminderPanel">
                        <div class="absolute top-0 right-0 p-2 opacity-10"><i class="text-6xl">üìÖ</i></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-indigo-200 font-bold text-sm">üìÖ Agenda & Alarm</h3>
                                <button onclick="enableAlarm()" id="btnEnableAlarm" class="bg-yellow-600 hover:bg-yellow-500 text-white text-[10px] px-2 py-1 rounded flex items-center gap-1 shadow-lg animate-pulse">
                                    üîî Aktifkan Alarm
                                </button>
                            </div>
                            <div class="flex gap-2 mb-2">
                                <input type="text" id="reminderTitle" class="flex-1 p-1.5 border border-indigo-500 bg-gray-900 text-white text-xs rounded focus:outline-none" placeholder="Misal: SGP Result Delay">
                                <input type="date" id="reminderDate" class="p-1.5 border border-indigo-500 bg-gray-900 text-white text-xs rounded focus:outline-none text-gray-400">
                                <button onclick="addReminder()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 rounded text-xs font-bold">‚ûï</button>
                            </div>
                            <div id="reminderList" class="max-h-[80px] overflow-y-auto space-y-1 pr-1 custom-scrollbar">
                                <div class="text-indigo-400 text-[10px] italic text-center">Belum ada pengingat aktif.</div>
                            </div>
                        </div>
                    </div>

                    <!-- List Kendala ‚Äî sekarang full height di kolom tengah -->
                    <div class="bg-gray-800 p-3 rounded-xl border border-gray-600 glow flex-1 flex flex-col overflow-hidden">
                        <div class="flex items-center justify-between mb-2 shrink-0">
                            <h3 class="text-sm font-bold text-gray-200">üìã Kendala Saat Ini</h3>
                            <button onclick="clearAllKendala()" class="text-[10px] bg-red-900/50 text-red-300 px-2 py-0.5 rounded hover:bg-red-800">üóëÔ∏è Clear</button>
                        </div>
                        <div id="kendalaList" class="space-y-1.5 flex-1 overflow-y-auto pr-1">
                            <p class="text-gray-500 text-xs text-center py-4">Belum ada kendala.</p>
                        </div>
                        
                        <!-- Mini Stats -->
                        <div class="mt-2 pt-2 border-t border-gray-700 grid grid-cols-4 gap-1 text-center shrink-0">
                            <div class="bg-gray-900/80 p-1 rounded border border-blue-900/50">
                                <div class="text-[9px] text-blue-500 font-bold mb-0.5">BANK</div>
                                <div class="text-xs font-bold text-blue-400" id="statBank">0</div>
                            </div>
                            <div class="bg-gray-900/80 p-1 rounded border border-purple-900/50">
                                <div class="text-[9px] text-purple-500 font-bold mb-0.5">GAME</div>
                                <div class="text-xs font-bold text-purple-400" id="statGame">0</div>
                            </div>
                            <div class="bg-gray-900/80 p-1 rounded border border-pink-900/50">
                                <div class="text-[9px] text-pink-500 font-bold mb-0.5">PROV</div>
                                <div class="text-xs font-bold text-pink-400" id="statProvider">0</div>
                            </div>
                            <div class="bg-gray-900/80 p-1 rounded border border-orange-900/50">
                                <div class="text-[9px] text-orange-500 font-bold mb-0.5">LAIN</div>
                                <div class="text-xs font-bold text-orange-400" id="statLainnya">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                     RIGHT COLUMN (30%): Hasil Report + Riwayat
                ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                <div class="xl:w-[30%] flex flex-col h-full overflow-hidden gap-0 bg-gray-800/40 rounded-xl border border-gray-700/50">

                    <!-- ‚îÄ‚îÄ HEADER PANEL KANAN ‚îÄ‚îÄ -->
                    <div class="p-3 bg-gray-800 border-b border-gray-700 flex justify-between items-center shrink-0">
                        <h3 class="text-sm font-bold text-blue-300">üóÇÔ∏è Report &amp; Riwayat</h3>
                        <button onclick="clearHistory()" class="text-[10px] text-red-400 hover:text-red-300 underline">Hapus Riwayat</button>
                    </div>

                    <div class="flex-1 overflow-y-auto p-3 flex flex-col gap-4">

                        <!-- ‚ïê‚ïê HASIL REPORT ‚Äî DIPINDAH KE SINI ‚ïê‚ïê -->
                        <div class="output-panel-embedded shrink-0">
                            <!-- Label + Actions -->
                            <div class="flex items-center justify-between flex-wrap gap-2 mb-2">
                                <div class="output-label">üì§ Hasil Report</div>
                                <div class="output-actions">
                                    <button onclick="downloadReport()" class="text-[10px] bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded border border-gray-600 flex items-center gap-1 transition-colors">üíæ .txt</button>
                                    <button onclick="saveToHistory()" class="text-[10px] bg-indigo-700 hover:bg-indigo-600 text-white px-2 py-1 rounded shadow transition-colors">üíæ Simpan</button>
                                    <button id="copyBtn" onclick="copyToClipboard()" class="text-[10px] bg-emerald-600 hover:bg-emerald-500 text-white px-2 py-1 rounded font-bold shadow transition-colors">üìã Salin</button>
                                </div>
                            </div>
                            <!-- Output full-width, no truncation -->
                            <div class="report-output-wrapper">
                                <textarea id="output" readonly spellcheck="false"></textarea>
                            </div>
                        </div>

                        <!-- ‚ïê‚ïê RIWAYAT LAPORAN ‚ïê‚ïê -->
                        <div class="flex flex-col gap-1 shrink-0">
                            <div class="flex items-center gap-2 mb-1 px-1">
                                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">üìÅ Riwayat Tersimpan</span>
                            </div>
                            <div id="historyList" class="flex flex-col gap-2">
                                <div class="text-center text-gray-500 text-xs py-4 italic">Belum ada riwayat tersimpan.</div>
                            </div>
                        </div>

                    </div><!-- /scroll-wrap -->
                </div><!-- /col-right -->

            </div><!-- /3-column grid -->
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-gray-800 rounded-2xl shadow-2xl border border-gray-600 w-full max-w-xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-900 to-indigo-900 p-4 flex justify-between items-center border-b border-blue-700">
                <h3 class="text-lg font-bold text-white">üì• Import / Paste Data</h3>
                <button onclick="closeImportModal()" class="text-gray-300 hover:text-white text-2xl leading-none">&times;</button>
            </div>
            <div class="p-4">
                <p class="text-gray-300 mb-3 text-xs">Paste teks report sebelumnya di sini. Sistem akan otomatis mengisi nama, checklist, link, dan kendala.</p>
                <textarea id="importArea" class="w-full h-40 p-3 bg-gray-900 text-white border-2 border-gray-600 rounded-xl font-mono text-xs focus:border-blue-500 focus:outline-none resize-none"></textarea>
            </div>
            <div class="p-4 bg-gray-900 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="closeImportModal()" class="px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700 text-sm">Batal</button>
                <button onclick="processImport()" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold shadow-lg text-sm">‚ú® Proses</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 border-l-4 border-emerald-500 text-white px-5 py-3 rounded shadow-2xl transform translate-y-20 transition-transform duration-300 z-50 flex items-center gap-3">
        <span class="text-lg">‚úÖ</span>
        <span id="toastMsg" class="font-semibold text-sm">Berhasil!</span>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         JAVASCRIPT ‚Äî TIDAK ADA PERUBAHAN LOGIC / FUNGSI
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        // --- DATA & STATE ---
        let savedKendala = [];
        let reportHistory = [];
        let reminders = []; 
        let alarmEnabled = false;
        
        const defaultChecklist = [
            { text: 'Channel WA Prediksi pasaran besar setiap hari 1x', checked: false },
            { text: 'Syair / Prediksi', checked: false },
            { text: 'Kemenangan Besar diatas 30Jt 1x', checked: false },
            { text: 'Kemenangan Besar diatas 30Jt 2x', checked: false },
            { text: 'Link Alternatif Seminggu 1x', checked: false },
            { text: 'Wordpress Syair', checked: false },
            { text: 'Facebook Posting Mingguan (Selasa & Jumat)', checked: false },
            { text: 'Maintenance', checked: false },
            { text: 'Perubahan Jadwal Pasaran', checked: false },
            { text: 'Posting Mingguan rutin (Selasa & Jumat)', checked: false },
            { text: 'Info Penting Keterlambatan Result', checked: false },
            { text: 'Wordpress Kemenangan besar di atas 80jt', checked: false }
        ];

        let checklist = JSON.parse(JSON.stringify(defaultChecklist));

        const categoryIcons = { bank: 'üè¶', game: 'üéÆ', provider: 'üì±', lainnya: '‚ö†Ô∏è' };
        const categoryNames = { bank: 'KENDALA BANK', game: 'KENDALA GAME', provider: 'KENDALA PROVIDER', lainnya: 'KENDALA LAINNYA' };

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            loadReminders();
            loadHistory();
            initChecklist();
            updateKendalaList();
            updateStats();
            renderReminders();
            generateReport();
            setInterval(checkAlarms, 60000);
        });

        // --- LOCAL STORAGE FUNCTIONS ---
        function saveData() {
            const data = {
                csName: document.getElementById('csName').value,
                shift: document.getElementById('shift').value,
                linkYT: document.getElementById('linkYT').value,
                linkAman: document.getElementById('linkAman').value,
                checklist: checklist,
                kendala: savedKendala
            };
            localStorage.setItem('tvtoto_report_v7', JSON.stringify(data));
        }

        function loadData() {
            const stored = localStorage.getItem('tvtoto_report_v7');
            if (stored) {
                const data = JSON.parse(stored);
                document.getElementById('csName').value = data.csName || '';
                document.getElementById('shift').value = data.shift || 'Pagi';
                document.getElementById('linkYT').value = data.linkYT || '';
                document.getElementById('linkAman').value = data.linkAman || '';
                
                if (data.checklist && data.checklist.length > 0) {
                    checklist = defaultChecklist.map(def => {
                        const savedItem = data.checklist.find(s => s.text === def.text);
                        return savedItem ? { ...def, checked: savedItem.checked } : { ...def };
                    });
                }
                if (data.kendala) savedKendala = data.kendala;
            }
        }

        // --- REMINDER & ALARM LOGIC ---
        function loadReminders() {
            const stored = localStorage.getItem('tvtoto_reminders_v7');
            if (stored) reminders = JSON.parse(stored);
        }

        function saveReminders() {
            localStorage.setItem('tvtoto_reminders_v7', JSON.stringify(reminders));
        }

        function enableAlarm() {
            if (!("Notification" in window)) {
                alert("Browser ini tidak mendukung notifikasi sistem.");
            } else if (Notification.permission === "granted") {
                alarmEnabled = true;
                showToast("Alarm Diaktifkan!");
                document.getElementById('btnEnableAlarm').classList.add('hidden');
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(function (permission) {
                    if (permission === "granted") {
                        alarmEnabled = true;
                        showToast("Alarm Diaktifkan!");
                        document.getElementById('btnEnableAlarm').classList.add('hidden');
                    }
                });
            }
        }

        function playBeep() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gainNode = ctx.createGain();
                osc.connect(gainNode);
                gainNode.connect(ctx.destination);
                osc.type = "sine";
                osc.frequency.value = 880;
                gainNode.gain.value = 0.1;
                osc.start();
                setTimeout(() => { osc.stop(); ctx.close(); }, 200);
            } catch (e) { console.log("Audio play error", e); }
        }

        function checkAlarms() {
            if (!alarmEnabled) return;
            const today = new Date();
            today.setHours(0,0,0,0);
            reminders.forEach(r => {
                const targetDate = new Date(r.date);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays === 0 || diffDays === 1) {
                    playBeep();
                    if (Notification.permission === "granted") {
                        new Notification(`Pengingat: ${r.title}`, {
                            body: `Akan terjadi dalam ${diffDays} hari lagi!`,
                            icon: 'https://cdn-icons-png.flaticon.com/512/3239/3239945.png'
                        });
                    }
                }
            });
        }

        function addReminder() {
            const title = document.getElementById('reminderTitle').value.trim();
            const date = document.getElementById('reminderDate').value;
            if (!title || !date) { alert("Isi Judul dan Tanggal!"); return; }
            reminders.push({ id: Date.now(), title, date });
            reminders.sort((a, b) => new Date(a.date) - new Date(b.date));
            document.getElementById('reminderTitle').value = '';
            document.getElementById('reminderDate').value = '';
            saveReminders();
            renderReminders();
            showToast("Pengingat Ditambahkan!");
        }

        function renderReminders() {
            const container = document.getElementById('reminderList');
            const today = new Date();
            today.setHours(0,0,0,0);
            if (reminders.length === 0) {
                container.innerHTML = '<div class="text-indigo-400 text-[10px] italic text-center">Belum ada pengingat aktif.</div>';
                return;
            }
            container.innerHTML = '';
            reminders.forEach(r => {
                const targetDate = new Date(r.date);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                let badgeClass = "bg-green-900 text-green-200 border-green-700";
                let badgeText = `${diffDays} Hari Lagi`;
                if (diffDays < 0) { badgeClass = "bg-gray-700 text-gray-400 border-gray-600"; badgeText = "Lewat"; }
                else if (diffDays === 0) { badgeClass = "bg-red-600 text-white border-red-500 pulse-red"; badgeText = "HARI INI!"; }
                else if (diffDays <= 3) { badgeClass = "bg-orange-700 text-orange-200 border-orange-600"; }
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-indigo-800/30 border border-indigo-700/50 rounded p-1.5';
                div.innerHTML = `
                    <span class="text-xs text-indigo-100 truncate w-2/3 font-medium">${r.title}</span>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold px-1.5 py-0.5 rounded border ${badgeClass}">${badgeText}</span>
                        <button onclick="deleteReminder(${r.id})" class="text-indigo-400 hover:text-red-400 text-xs">&times;</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveReminders();
            renderReminders();
        }

        // --- QUICK TEMPLATE & MANUAL INPUT ---
        function quickAdd(text, category) {
            savedKendala.push({ text, kategori: category });
            updateKendalaList();
            updateStats();
            generateReport();
            saveData();
            showToast("Kendala Ditambah!");
        }

        function tambahKendalaBaru() {
            const text = document.getElementById('kendalaText').value.trim();
            const kategori = document.getElementById('kategoriDropdown').value;
            if (!text) { alert('Mohon isi deskripsi kendala!'); return; }
            savedKendala.push({ text, kategori });
            document.getElementById('kendalaText').value = '';
            updateKendalaList();
            updateStats();
            generateReport();
            saveData();
            showToast("Kendala Manual Ditambah");
        }

        // --- HISTORY LOGIC ---
        function loadHistory() {
            const stored = localStorage.getItem('tvtoto_history_v7');
            if (stored) {
                reportHistory = JSON.parse(stored);
                renderHistory();
            }
        }

        function saveToHistory() {
            const csName = document.getElementById('csName').value || 'Tanpa Nama';
            const reportContent = document.getElementById('output').value;
            const timestamp = new Date().toLocaleString('id-ID', { dateStyle: 'short', timeStyle: 'short' });
            const newEntry = { id: Date.now(), csName, date: timestamp, content: reportContent };
            reportHistory.unshift(newEntry);
            if (reportHistory.length > 20) reportHistory.pop();
            localStorage.setItem('tvtoto_history_v7', JSON.stringify(reportHistory));
            renderHistory();
            showToast("Disimpan ke Riwayat");
        }

        function renderHistory() {
            const container = document.getElementById('historyList');
            if (reportHistory.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 text-xs py-4 italic">Belum ada riwayat tersimpan.</div>';
                return;
            }
            container.innerHTML = '';
            reportHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item bg-gray-800 border border-gray-700 rounded-lg overflow-hidden cursor-pointer relative group';

                // Full report content ‚Äî wrap text, no truncation
                const reportHtml = `
                    <div style="
                        overflow-x: auto;
                        background: rgba(0,0,0,0.4);
                        border-top: 1px solid #374151;
                        padding: 10px 12px;
                    ">
                        <pre style="
                            font-family: 'Courier New', Courier, monospace;
                            font-size: 10px;
                            color: #d1fae5;
                            white-space: pre-wrap;
                            word-break: break-word;
                            overflow-wrap: break-word;
                            line-height: 1.65;
                            margin: 0;
                        ">${escapeHtml(item.content)}</pre>
                    </div>
                `;

                div.innerHTML = `
                    <!-- Card Header -->
                    <div class="flex justify-between items-center px-3 py-2 bg-gray-800">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-xs text-blue-300">${item.csName}</span>
                            <span class="text-[9px] bg-blue-900/50 text-blue-400 px-1.5 py-0.5 rounded border border-blue-800">Riwayat</span>
                        </div>
                        <span class="text-[10px] text-gray-500 whitespace-nowrap">${item.date}</span>
                    </div>

                    <!-- Full Report Content (wrap, no ellipsis) -->
                    ${reportHtml}

                    <!-- Actions -->
                    <div class="flex gap-2 px-3 py-2 bg-gray-900/60 border-t border-gray-700/50 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="copyHistoryText('${item.id}')" class="flex-1 bg-blue-900 hover:bg-blue-700 text-white text-[10px] py-1.5 rounded transition-colors">üìã Salin</button>
                        <button onclick="deleteHistoryItem('${item.id}')" class="bg-red-900 hover:bg-red-700 text-white px-3 py-1.5 rounded text-[10px] transition-colors">‚úï Hapus</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Helper: escape HTML untuk ditampilkan di dalam <pre>
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }

        function copyHistoryText(id) {
            const item = reportHistory.find(i => i.id == id);
            if (item) { navigator.clipboard.writeText(item.content).then(() => showToast("Riwayat Disalin!")); }
        }

        function deleteHistoryItem(id) {
            if(confirm('Hapus item ini?')) {
                reportHistory = reportHistory.filter(i => i.id != id);
                localStorage.setItem('tvtoto_history_v7', JSON.stringify(reportHistory));
                renderHistory();
            }
        }

        function clearHistory() {
            if(confirm('Hapus SEMUA riwayat?')) {
                reportHistory = [];
                localStorage.removeItem('tvtoto_history_v7');
                renderHistory();
            }
        }

        function downloadReport() {
            const text = document.getElementById('output').value;
            const filename = `Laporan_TVTOTO_${new Date().toISOString().slice(0,10)}.txt`;
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function resetAllData() {
            if(confirm('Yakin ingin menghapus SEMUA data?')) {
                localStorage.removeItem('tvtoto_report_v7');
                location.reload();
            }
        }

        // --- UI GENERATION ---
        function initChecklist() {
            const container = document.getElementById('checklistContainer');
            container.innerHTML = '';
            checklist.forEach((item, index) => {
                const btn = document.createElement('button');
                let baseClass = "flex items-center gap-2 p-2 rounded border transition-all text-left w-full text-xs ";
                if (item.checked) btn.className = baseClass + "bg-emerald-900 border-emerald-700 hover:bg-emerald-800 active";
                else btn.className = baseClass + "bg-red-900 border-red-800 hover:bg-red-800 inactive";
                btn.onclick = () => toggleCheck(index);
                btn.innerHTML = `<span>${item.checked ? '‚úÖ' : '‚ùå'}</span><span class="break-words leading-tight ${item.checked ? 'text-emerald-100' : 'text-red-200'}">${item.text}</span>`;
                container.appendChild(btn);
            });
        }

        function updateKendalaList() {
            const list = document.getElementById('kendalaList');
            if (savedKendala.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-xs text-center py-4">Belum ada kendala.</p>';
                return;
            }
            list.innerHTML = '';
            savedKendala.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'kendala-item flex items-start gap-2 p-2 bg-gray-700/50 rounded border border-gray-600 hover:border-gray-500';
                div.innerHTML = `
                    <span class="text-sm flex-shrink-0">${categoryIcons[item.kategori]}</span>
                    <div class="flex-1 min-w-0">
                        <p class="text-[10px] text-gray-400 font-bold uppercase">${categoryNames[item.kategori]}</p>
                        <p class="text-xs text-gray-200" style="white-space:normal;word-break:break-word;">${item.text}</p>
                    </div>
                    <button onclick="hapusKendala(${index})" class="text-red-400 hover:text-red-300 flex-shrink-0"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                `;
                list.appendChild(div);
            });
        }

        function updateStats() {
            const stats = { bank: 0, game: 0, provider: 0, lainnya: 0 };
            savedKendala.forEach(item => stats[item.kategori]++);
            document.getElementById("statBank").textContent = stats.bank;
            document.getElementById("statGame").textContent = stats.game;
            document.getElementById("statProvider").textContent = stats.provider;
            document.getElementById("statLainnya").textContent = stats.lainnya;
        }

        // --- ACTIONS ---
        function toggleCheck(index) {
            checklist[index].checked = !checklist[index].checked;
            initChecklist();
            generateReport();
            saveData();
        }

        function toggleAll(status) {
            checklist.forEach(item => item.checked = status);
            initChecklist();
            generateReport();
            saveData();
        }

        function hapusKendala(index) {
            savedKendala.splice(index, 1);
            updateKendalaList();
            updateStats();
            generateReport();
            saveData();
        }

        function clearAllKendala() {
            if (savedKendala.length === 0) return;
            if (confirm('Hapus semua kendala?')) {
                savedKendala = [];
                updateKendalaList();
                updateStats();
                generateReport();
                saveData();
            }
        }

        function generateReport() {
            const csName = document.getElementById('csName').value;
            const shift = document.getElementById('shift').value;
            const linkYT = document.getElementById('linkYT').value;
            const linkAman = document.getElementById('linkAman').value;
            const checked = checklist.filter(i => i.checked).map(i => i.text);
            const unchecked = checklist.filter(i => !i.checked).map(i => i.text);

            let result = `Nama CS : ${csName}\nShift : ${shift}\n`;
            if (linkYT) result += `Link YT : ${linkYT}\n`;
            if (linkAman) result += `Link Aman : ${linkAman}\n`;
            if (checked.length > 0) result += `\n‚úÖ ${checked.join('\n‚úÖ ')}\n`;
            if (unchecked.length > 0) result += `\n‚ùå ${unchecked.join('\n‚ùå ')}\n`;

            ['bank', 'game', 'provider', 'lainnya'].forEach(kategori => {
                const items = savedKendala.filter(k => k.kategori === kategori);
                if (items.length > 0) {
                    result += `\n${categoryIcons[kategori]} ${categoryNames[kategori]}:\n`;
                    items.forEach(item => result += `  ‚Ä¢ ${item.text}\n`);
                }
            });

            document.getElementById('output').value = result;
        }

        function copyToClipboard() {
            const output = document.getElementById('output');
            output.select();
            output.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(output.value).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '‚úÖ Tersalin!';
                setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
            });
        }

        // --- IMPORT LOGIC ---
        function openImportModal() {
            document.getElementById('importModal').classList.remove('hidden');
            document.getElementById('importModal').classList.add('flex');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
            document.getElementById('importModal').classList.remove('flex');
        }

        function processImport() {
            const text = document.getElementById('importArea').value;
            if(!text.trim()) { alert("Teks kosong!"); return; }
            const lines = text.split('\n');
            let currentCategory = null;
            savedKendala = [];

            lines.forEach(line => {
                const cleanLine = line.trim();
                if (cleanLine.toLowerCase().includes('nama cs :')) document.getElementById('csName').value = cleanLine.split(/nama cs :/i)[1].trim();
                else if (cleanLine.toLowerCase().includes('shift :')) {
                    const val = cleanLine.split(/shift :/i)[1].trim();
                    const shiftSelect = document.getElementById('shift');
                    if ([...shiftSelect.options].some(o => o.value === val)) shiftSelect.value = val;
                }
                else if (cleanLine.toLowerCase().includes('link yt')) document.getElementById('linkYT').value = cleanLine.split(/link yt :?/i)[1]?.trim() || '';
                else if (cleanLine.toLowerCase().includes('link aman')) document.getElementById('linkAman').value = cleanLine.split(/link aman :?/i)[1]?.trim() || '';
                else if (cleanLine.startsWith('‚úÖ')) {
                    const itemText = cleanLine.substring(2).trim();
                    const item = checklist.find(c => c.text === itemText);
                    if (item) item.checked = true;
                }
                else if (cleanLine.startsWith('‚ùå')) {
                    const itemText = cleanLine.substring(2).trim();
                    const item = checklist.find(c => c.text === itemText);
                    if (item) item.checked = false;
                }
                else if (cleanLine.includes('KENDALA BANK')) currentCategory = 'bank';
                else if (cleanLine.includes('KENDALA GAME')) currentCategory = 'game';
                else if (cleanLine.includes('KENDALA PROVIDER')) currentCategory = 'provider';
                else if (cleanLine.includes('KENDALA LAINNYA')) currentCategory = 'lainnya';
                else if (currentCategory && (cleanLine.startsWith('‚Ä¢') || cleanLine.startsWith('-') || cleanLine.length > 0)) {
                    let itemText = cleanLine;
                    if(itemText.startsWith('‚Ä¢') || itemText.startsWith('-')) itemText = itemText.substring(1).trim();
                    if(itemText.length > 0) savedKendala.push({ text: itemText, kategori: currentCategory });
                }
            });

            initChecklist();
            updateKendalaList();
            updateStats();
            generateReport();
            saveData();
            closeImportModal();
            document.getElementById('importArea').value = '';
            showToast("Import Berhasil!");
        }

        ['csName', 'shift', 'linkYT', 'linkAman'].forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('input', () => { generateReport(); saveData(); });
            el.addEventListener('change', () => { generateReport(); saveData(); });
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toastMsg');
            msgEl.textContent = message;
            toast.classList.remove('translate-y-20');
            setTimeout(() => { toast.classList.add('translate-y-20'); }, 2000);
        }
    </script>
</body>
</html>
